# #3854: [Proposal] Optimization for AoS with SIMD

- **URL:** https://github.com/WebAssembly/binaryen/issues/3854
- **Author:** MaxGraey
- **Created:** 2021-05-03
- **Updated:** 2021-05-04

## Description

Not sure where this should be best done - at the compiler level, at the binaryen level, or at the VM runtime level.

As the GC proposal adds structures and arrays, we technically have the ability to turn AoS into SoA or AoSoA (with fixed SIMD proposal).
Like (pseudocode):
```cpp
class Vec3 {
    f32 x;
    f32 y;
    f32 z;
};
const vels = Vec3[100];
f32 getVelX(i32 i) { 
  return vels[i].x;
}
```
into:
```cpp
class Vec3 {
    f32 x[4];
    f32 y[4];
    f32 z[4];
};
const vels = Vec3[(100 + 3) / 4];
f32 getVelX(i32 i) { 
  return vels[i / 4].x[i & 3];
 }
```
And apply SIMD auto-vectorisation afterwards.
 
