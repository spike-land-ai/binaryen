# #5549: optimize for if with return statement

- **URL:** https://github.com/WebAssembly/binaryen/issues/5549
- **Author:** HerrCai0907
- **Created:** 2023-03-07
- **Updated:** 2023-03-07

## Description

I have this code snippet
```wat
  local.get $0
  if
   local.get $0
   i32.const 1
   i32.add
   return
  end
  local.get $0
  if
   i32.const 100
   return
  end
  local.get $0
```
It can be optimized to
```wat
    local.get 0
    if  ;; label = @1
      local.get 0
      i32.const 1
      i32.add
      return
    end
    local.get 0
    if  ;; label = @1
      i32.const 100
      return
    end
    local.get 0
```

But it can be optimized as following code because second if conditional is always false.
```wat
    local.get 0
    if  ;; label = @1
      local.get 0
      i32.const 1
      i32.add
      return
    end
    local.get 0
```


## Comments (2)

### MaxGraey (2023-03-07)

I guess it could be done in another way by merging this two branches into single block as proposed here: https://github.com/WebAssembly/binaryen/issues/4268
After that existing DAE / vacuum pass will remove second `return` part

---

### kripken (2023-03-07)

Another option is a more general solution which looks at conditions and control flow, like LLVM and others have. Something like noting which conditions must be true after each condition in each branch, and doing a CFG flow. That is not easy, however, so perhaps simpler specific rules like merging subsequent if conditions makes sense meanwhile, as is the case here.

---

