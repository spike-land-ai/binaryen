# #6506: How to remove no-op exported functions?

- **URL:** https://github.com/WebAssembly/binaryen/issues/6506
- **Author:** orsinium
- **Created:** 2024-04-17
- **Updated:** 2024-04-18
- **Labels:** enhancement, help wanted, good first bug

## Description

### Discussed in https://github.com/WebAssembly/binaryen/discussions/6501

<div type='discussions-op-text'>

<sup>Originally posted by **orsinium** April 15, 2024</sup>
Quite often, after all optimizations, wasm-opt leaves exported functions empty:

```
(module
  (type (func))
  (func (type 0)
    nop)
  (export "example" (func 0)))
```

Is there a way to tell wasm-opt that it is also safe to remove the exported functions if they are empty? I know for sure that the target runtime handles missed exports correctly.</div>

Based on the discussion, there is currently no way to do so. Hence we decided that it's worth opening a proper feature request. The feature would help a lot with code optimization on both guest and host sides in situations when the host doesn't require the exported functions to be present.

## Comments (3)

### kripken (2024-04-17)

Two possible ways to add such a feature:
1. As a pass-option for RemoveUnusedModuleElements pass.
2. Add a flag to wasm-metadce.
In both cases the option would be something like "consider empty exports unused".

Which runtime is this, btw, that will safely ignore empty exports?

---

### orsinium (2024-04-18)

> Which runtime is this, btw, that will safely ignore empty exports?

[I'm building my own Rust runtime](https://firefly.orsinium.dev/) on top of [wasmi](https://github.com/paritytech/wasmi). Knowing that the guest does not implement certain functions lets me do host-side optimizations. Similar to how [pico-8](https://www.lexaloffle.com/pico-8.php) changes the frame rate to 60 FPS if [_UPDATE60](https://www.lexaloffle.com/dl/docs/pico-8_manual.html#Running_PICO_8_at_60fps) function is provided.

Another example is [wasm-4](https://wasm4.org/). It expects `start` and `update` exports both of which may be omitted:

* https://github.com/aduros/wasm4/blob/main/runtimes/web/src/runtime.ts#L319-L322
* https://github.com/aduros/wasm4/blob/main/runtimes/web/src/runtime.ts#L334-L338

---

### kripken (2024-04-18)

I see, thanks for the info @orsinium !

With multiple VMs that could benefit here, this sounds very reasonable to add as an option.

Probably the first option I mentioned before (pass-option for RemoveUnusedModuleElements) is best. If someone has time to look into that but doesn't know where to start I can help out with guidance.

---

