# #2850: Stack pointer checks do not handle an underflow of 0

- **URL:** https://github.com/WebAssembly/binaryen/issues/2850
- **Author:** kripken
- **Created:** 2020-05-14
- **Updated:** 2020-05-14
- **Labels:** help wanted, good first bug

## Description

The LLVM wasm stack goes down, and if we start from X and ask for Y stack space, if Y is bigger than X, we end up with a large unsigned 32-bit number. The current stack checks in `stackBoundsCheck` in `wasm-emscripten.cpp` only look at the final value, after the adjustment, so they don't know an overflow happened.

One option is to check for an overflow explicitly. However, for that we need to know the offset, and when LLVM just gives us code that does operations on the stack pointer, that's not explicit. So perhaps LLVM could do this in the backend?

Alternatively, we could check not just for being past the end of the stack, but being before the beginning. That wouldn't catch an overflow all the way back into the stack (like say to grow by almost `2^32`), but it should catch almost everything. To do that we'd need wasm-emscripten to get both addresses (`__set_stack_limit` gets just one so far), and for emscripten to send both.
