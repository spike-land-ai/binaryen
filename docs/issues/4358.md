# #4358: Missing 64-bit AtomicCmpxchg causes `__sync_fetch_and_nand` to fail under wasm2js

- **URL:** https://github.com/WebAssembly/binaryen/issues/4358
- **Author:** sbc100
- **Created:** 2021-11-24
- **Updated:** 2024-05-17

## Description

Usage of `__sync_fetch_and_nand` with 64-bit operands in emscripten causes the following error:

```
wasm2js: /usr/local/google/home/sbc/dev/wasm/binaryen/src/passes/I64ToI32Lowering.cpp:471: void wasm::I64ToI32Lowering::visitAtomicCmpxchg(wasm::AtomicCmpxchg *): Assertion `curr->type != Type::i64 && "64-bit AtomicCmpxchg not implemented"' failed.
```

I think this is probably super rare and not a huge deal, but creating this issue so I can link to it in the test code.

## Comments (2)

### sbc100 (2024-05-17)

@kripken should we care about this?

---

### kripken (2024-05-17)

I don't think I heard of this affecting real-world code, so it seems like a very low priority to me.

---

