# #8203: MinifyImportsAndExports fails on duplicate names.

- **URL:** https://github.com/WebAssembly/binaryen/issues/8203
- **Author:** karlosz
- **Created:** 2026-01-14
- **Updated:** 2026-01-15

## Description

When running the minification pass with --minify-imports-and-exports-and-modules, the pass will fail with the following assertion:

```
Assertion failed: (res.second), function operator(), file MinifyImportsAndExports.cpp, line 118.
[1]    5104 abort      wasm-opt opt.wasm --enable-reference-types --enable-gc --enable-bulk-memory
```

This appears to be because the pass does not deal well with duplicate names, even if they come from different modules. In fact, duplicate imports even with the same module and name is explicitly allowed by the WebAssembly specification.

## Comments (4)

### kripken (2026-01-14)

Do you have an example binary showing the problem?

---

### karlosz (2026-01-14)

Yes, I do, but GitHub does not allow uploading .wasm files here. The binary produced by an empty Kotlin composeApp is enough to reproduce the issue, and I am pretty sure that just defining a binary with something like (import "x" "a") (import "y" "a") will trigger as well. Removing the lines hidden behind #ifndef NDEBUG here https://github.com/WebAssembly/binaryen/blob/a8ccf9908f4274006634f821404980e7e432afe9/src/passes/MinifyImportsAndExports.cpp#L111 fixes the issue.

---

### kripken (2026-01-14)

You can upload wasm files if you put them in a zip file, or another allowed container. Yeah, that is an annoying thing on github...

I tried your suggestion but don't see an error:
```wat
(module
  (import "x" "a" (func $foo))
  (import "y" "a" (func $bar))
  (export "export1" (func $foo))
  (export "export2" (func $bar))
)
```
```
$ bin/wasm-opt a.wat --minify-imports-and-exports --print
export1 => a
export2 => b
(module
 (type $0 (func))
 (import "x" "a" (func $foo))
 (import "y" "a" (func $bar))
 (export "a" (func $foo))
 (export "b" (func $bar))
)
```


---

### karlosz (2026-01-15)

If you use the flag --minify-imports-and-exports-and-modules (note the extra -modules bit), it does crash on that example.

---

