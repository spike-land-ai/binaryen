# #5245: Consider running tests with -D_LIBCPP_ENABLE_ASSERTIONS=1

- **URL:** https://github.com/WebAssembly/binaryen/issues/5245
- **Author:** mxms0
- **Created:** 2022-11-12
- **Updated:** 2022-11-14

## Description

There's a handful of instances across binaryen/wasm-opt where there is "technically C++ Undefined Behavior". These code defects may be causing nondeterminism, or random failures. 

For example, https://github.com/WebAssembly/binaryen/blob/main/src/wasm/wasm-s-parser.cpp#L1154, `str.size()` is checked to be `>= 3`, and then `str[3]` is accessed. There's a few more instances in wasm-s-parser.cpp, for what it's worth. They should all be easy fixes :) 

Building all of binaryen with -D_LIBCPP_ENABLE_ASSERTIONS=1 should point out these issues pretty quickly, or running the existing fuzzer after enabling this build macro. More info on this build macro: https://libcxx.llvm.org/DesignDocs/DebugMode.html (This is a clang-LLVM only thing). 

## Comments (1)

### kripken (2022-11-14)

Sounds good to me. A PR adding this for one of our CI test runs would be great. The relevant file for this is `.github/workflows/ci.yml` I believe.

---

