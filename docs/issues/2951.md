# #2951: redundant second cast to integer after already casted int value in asm.js?

- **URL:** https://github.com/WebAssembly/binaryen/issues/2951
- **Author:** MaxGraey
- **Created:** 2020-07-10
- **Updated:** 2020-07-10

## Description

https://webassembly.studio/?f=oeg02m22gmq

```ts
export function add_div(x: i32): i32 {
  return u32(x) / 100 + x / -100;
}
```
output:
```js
 function main_add_div($0) {
  $0 = $0 | 0;
  return (($0 | 0) / (-100 | 0) | 0) + (($0 >>> 0) / (100 >>> 0) | 0) | 0 | 0;
 }
```
but I'm expecting single `| 0` at the end:
```js
 function main_add_div($0) {
  $0 = $0 | 0;
  return (($0 | 0) / (-100 | 0) | 0) + (($0 >>> 0) / (100 >>> 0) | 0) | 0;
 }
```

similar [here](https://github.com/WebAssembly/binaryen/blob/master/test/wasm2js/add_div.2asm.js#L25)
but after extra optimizations it normalized to [expected](https://github.com/WebAssembly/binaryen/blob/master/test/wasm2js/add_div.2asm.js.opt#L25). But I guess it could be done earlier without extra opts?

also since asm2js is more like js code and less than asm.js could we simplify some conversion? Like this one:
```js
function i32_trunc_u_f32($0) {
  $0 = Math_fround($0);
  return ~~$0 >>> 0 | 0;
}
```
could be just:
```js
function i32_trunc_u_f32($0) {
  $0 = Math_fround($0);
  return $0 | 0;
}
```
And Closure Compiler can't do such optimizations btw

## Comments (1)

### kripken (2020-07-10)

Could be a missing optimization. Those are written in `src/tools/wasm2js.cpp`:`optimizeJS()`.

---

