# #6391: wasm-opt: "compile unit size was incorrect"

- **URL:** https://github.com/WebAssembly/binaryen/issues/6391
- **Author:** daxpedda
- **Created:** 2024-03-08
- **Updated:** 2025-09-30

## Description

I'm unsure what exactly triggers this issue, but I tried several versions: v112, v116, v117, they all fail with the same message:
```
compile unit size was incorrect (this may be an unsupported version of DWARF)
UNREACHABLE executed at /home/runner/work/binaryen/binaryen/third_party/llvm-project/DWARFEmitter.cpp:200!
```
This is the command used: `wasm-opt test.wasm -O -o test.opt.wasm`.
The Wasm file: [test.zip](https://github.com/WebAssembly/binaryen/files/14544170/test.zip). 


## Comments (3)

### kripken (2024-03-08)

Our DWARF support is not very robust, so you are likely hitting a limitation there.

In general I would recommend using source maps support for debugging instead of DWARF, whenever possible - that is stable.

---

### daxpedda (2024-11-29)

Apparently the issue was quite simple: the DWARF sections were entirely empty. Unfortunately I'm not very familiar with the DWARF standard and I don't know if this is actually a bug by `wasm-opt` or if this is just invalid.

<details>
  <summary><code>wasm-objdump -s</code> output</summary>
  
  ```  
  test_bg.wasm:	file format wasm 0x1
  module name: <test.wasm>
  
  Sections:
  
       Type start=0x0000000a end=0x0000000e (size=0x00000004) count: 1
   Function start=0x00000010 end=0x00000012 (size=0x00000002) count: 1
     Memory start=0x00000014 end=0x00000017 (size=0x00000003) count: 1
     Global start=0x00000019 end=0x00000022 (size=0x00000009) count: 1
     Export start=0x00000024 end=0x00000035 (size=0x00000011) count: 2
       Code start=0x00000037 end=0x0000003b (size=0x00000004) count: 1
     Custom start=0x0000003d end=0x0000006b (size=0x0000002e) "name"
     Custom start=0x0000006e end=0x000000f1 (size=0x00000083) "producers"
     Custom start=0x000000f3 end=0x00000101 (size=0x0000000e) ".debug_abbrev"
     Custom start=0x00000103 end=0x0000010e (size=0x0000000b) ".debug_str"
     Custom start=0x00000110 end=0x00000120 (size=0x00000010) ".debug_line_str"
     Custom start=0x00000122 end=0x0000012e (size=0x0000000c) ".debug_line"
     Custom start=0x00000130 end=0x0000013e (size=0x0000000e) ".debug_ranges"
     Custom start=0x00000140 end=0x00000150 (size=0x00000010) ".debug_rnglists"
     Custom start=0x00000152 end=0x0000015d (size=0x0000000b) ".debug_loc"
     Custom start=0x0000015f end=0x0000016f (size=0x00000010) ".debug_loclists"
     Custom start=0x00000171 end=0x0000017d (size=0x0000000c) ".debug_info"
     Custom start=0x0000017f end=0x0000018c (size=0x0000000d) ".debug_frame"
     Custom start=0x0000018e end=0x00000198 (size=0x0000000a) ".eh_frame"
     Custom start=0x0000019a end=0x000001bc (size=0x00000022) "target_features"
  
  Contents of section Type:
  000000a: 0160 0000                                .`..
  
  Contents of section Function:
  0000010: 0100                                     ..
  
  Contents of section Memory:
  0000014: 0100 10                                  ...
  
  Contents of section Global:
  0000019: 017f 0141 8080 c000 0b                   ...A.....
  
  Contents of section Export:
  0000024: 0206 6d65 6d6f 7279 0200 0474 6573 7400  ..memory...test.
  0000034: 00                                       .
  
  Contents of section Code:
  0000037: 0102 000b                                ....
  
  Contents of section Custom:
  000003d: 046e 616d 6500 0a09 7465 7374 2e77 6173  .name...test.was
  000004d: 6d01 0701 0004 7465 7374 0712 0100 0f5f  m.....test....._
  000005d: 5f73 7461 636b 5f70 6f69 6e74 6572       _stack_pointer
  
  Contents of section Custom:
  000006e: 0970 726f 6475 6365 7273 0208 6c61 6e67  .producers..lang
  000007e: 7561 6765 0104 5275 7374 000c 7072 6f63  uage..Rust..proc
  000008e: 6573 7365 642d 6279 0305 7275 7374 6325  essed-by..rustc%
  000009e: 312e 3835 2e30 2d6e 6967 6874 6c79 2028  1.85.0-nightly (
  00000ae: 3662 3661 3836 3761 6520 3230 3234 2d31  6b6a867ae 2024-1
  00000be: 312d 3237 2906 7761 6c72 7573 0630 2e32  1-27).walrus.0.2
  00000ce: 332e 310c 7761 736d 2d62 696e 6467 656e  3.1.wasm-bindgen
  00000de: 1230 2e32 2e39 3520 2865 3535 3363 6335  .0.2.95 (e553cc5
  00000ee: 3764 29                                  7d)
  
  Contents of section Custom:
  00000f3: 0d2e 6465 6275 675f 6162 6272 6576       ..debug_abbrev
  
  Contents of section Custom:
  0000103: 0a2e 6465 6275 675f 7374 72              ..debug_str
  
  Contents of section Custom:
  0000110: 0f2e 6465 6275 675f 6c69 6e65 5f73 7472  ..debug_line_str
  
  Contents of section Custom:
  0000122: 0b2e 6465 6275 675f 6c69 6e65            ..debug_line
  
  Contents of section Custom:
  0000130: 0d2e 6465 6275 675f 7261 6e67 6573       ..debug_ranges
  
  Contents of section Custom:
  0000140: 0f2e 6465 6275 675f 726e 676c 6973 7473  ..debug_rnglists
  
  Contents of section Custom:
  0000152: 0a2e 6465 6275 675f 6c6f 63              ..debug_loc
  
  Contents of section Custom:
  000015f: 0f2e 6465 6275 675f 6c6f 636c 6973 7473  ..debug_loclists
  
  Contents of section Custom:
  0000171: 0b2e 6465 6275 675f 696e 666f            ..debug_info
  
  Contents of section Custom:
  000017f: 0c2e 6465 6275 675f 6672 616d 65         ..debug_frame
  
  Contents of section Custom:
  000018e: 092e 6568 5f66 7261 6d65                 ..eh_frame
  
  Contents of section Custom:
  000019a: 0f74 6172 6765 745f 6665 6174 7572 6573  .target_features
  00001aa: 012b 0f6d 7574 6162 6c65 2d67 6c6f 6261  .+.mutable-globa
  00001ba: 6c73                                     ls
  ```

</details>

The Wasm file: [test_bg.zip](https://github.com/user-attachments/files/17953139/test_bg.zip)



---

### juancampa (2025-09-30)

> In general I would recommend using source maps support for debugging instead of DWARF, whenever possible - that is stable.

This works but it's honestly an underwhelming debugging experience since variables cannot be inspected. I'd say sourcemaps are good enough for stack traces but not for debugging.

Another drawback is that generating sourcemaps increases build times.

---

