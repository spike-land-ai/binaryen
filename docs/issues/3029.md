# #3029: Can we do more table element stripping in RemoveUnusedModuleElements?

- **URL:** https://github.com/WebAssembly/binaryen/issues/3029
- **Author:** sbc100
- **Created:** 2020-08-06
- **Updated:** 2020-08-06
- **Labels:** help wanted, good first bug

## Description

In RemoveUnusedModuleElements we clear the entire table if there is no usage of the table in the module:

https://github.com/WebAssembly/binaryen/blob/master/src/passes/RemoveUnusedModuleElements.cpp#L226

However, perhaps we could be more course grain:

1. Find all the signatures used by all call_indirect instructions.
2. Remove any table elements that don't match one of those signatures.

I guess this might make the table kind of sparse?   Would it be observable?   Using one of these slots would generate an "invalid signature" and now it would become "empty table slot".  I guess we could add per-signature trapping functions. These would never be reached and would preserve the "invalid signature" trap. 


## Comments (1)

### kripken (2020-08-06)

Good idea! I think this could be done if the table is neither imported nor exported (otherwise we don't see all the relevant calls into the table). That's the case in standalone mode at least in emscripten, and probably other places.

I think it's fine if we replace one trap by another, the binaryen optimizer already allows that.

---

