# #3057: Validate by default?

- **URL:** https://github.com/WebAssembly/binaryen/issues/3057
- **Author:** kripken
- **Created:** 2020-08-18
- **Updated:** 2020-08-19

## Description

Binaryen tools validate the wasm input by default (there is a flag to disable it). On a 200MB wasm file I'm looking at now, it takes 30% of the time (over 10 seconds) in a debug build (in an optimized one, the opts make it not matter).

Should we keep validating by default? Rarely it catches an LLVM bug, but not that often.

Maybe we could not validate by default, but only validate when verbose debugging is used? Like `BINARYEN_PASS_DEBUG` is set, or in emscripten, `EMCC_DEBUG`?

## Comments (8)

### binji (2020-08-18)

Not sure how binaryen does it, but I've found that a lot of tools are easier to write if the module is already validated before you process it. 

---

### kripken (2020-08-18)

@binji Oh, because while validating you collect information? Makes sense. Currently Binaryen is more like LLVM though, it has optional validation that produces no information, and is just for debugging.

---

### binji (2020-08-18)

I was thinking more that validation removes instruction sequences etc. that don't make sense, so tools don't need to handle them e.g.

```
(i32.add (i32.const 1) (f32.const 2))
```

---

### tlively (2020-08-18)

The most robust fix would probably be to make the Binaryen validator much more efficient, which I don't think would be too difficult.

---

### kripken (2020-08-19)

Good points @binji @tlively 

Yeah, I can see how another design could have benefited from validation. Right now though we don't. And I realize we can't really disable validation as we use it to error on bad binaries. Unlike LLVM, wasm is a standardized format and I don't think we can reduce our error handling for invalid inputs.

So yes, I think we should keep validating by default, and maybe look into optimizing that. I think we've already parallelized it in the past, but there may be more easy wins.

---

### tlively (2020-08-19)

@binji does wasp do binary validation?

---

### binji (2020-08-19)

It does, but it's pretty slow for debug builds, so I'm not sure if it will help here. It is set up to do streaming validation, so it shouldn't be too much effort to parallelize validation though.

---

### tlively (2020-08-19)

We probably want to be able to quickly validate Binaryen modules anyhow. The low hanging fruit would probably be getting rid of the ReFinalizeNode call on each expression, which makes validation at least quadratic in expression depth. Validation should be able to do just a linear traversal through each function.

---

