# #8198: Combining data segments

- **URL:** https://github.com/WebAssembly/binaryen/issues/8198
- **Author:** geraintluff
- **Created:** 2026-01-13
- **Updated:** 2026-01-14

## Description

AssemblyScript tends to produce a lot of `(data ...)` entries which are adjacent to each other, and seem like they could be combined.  [Here's an example](https://github.com/AssemblyScript/assemblyscript/blob/7f1f5a8cad016ae97498f9557ebb0a074bbd9aff/tests/compiler/memory.debug.wat).

I can see that `memory-packing` splits blocks up, but I don't see a way to combine them.  Am I missing something, and could this be added?

## Comments (2)

### kripken (2026-01-13)

I think you are right, we could combine segments in some cases.

One thing we'd need to be careful of is that if we have segments A, B, then if B traps due to out of bounds, A was still applied (while the merged A+B would trap without applying anything). So we can only merge them if (1) we assume nothing traps, or (2) we can prove it does not trap (but that is the common case).

---

### geraintluff (2026-01-14)

I tried it out upstream, by making AssemblyScript combine all its data segments into one, which Binaryen then splits.

Improvement on the bootstrapped AssemblyScript `.wasm` was 0.3% without Gzip, 0.6% with Gzip.  Just some thumb-in-the-air numbers, to help you decide what is/isn't worth the dev time.

---

