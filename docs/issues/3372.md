# #3372: Don't print the whole disassembly upon validation error

- **URL:** https://github.com/WebAssembly/binaryen/issues/3372
- **Author:** RReverser
- **Created:** 2020-11-16
- **Updated:** 2020-11-18

## Description

I'm getting "[wasm-validator error in module] unexpected true: Exported global cannot be mutable, on 
global$0" error in one of the modules I'm working on.

While I know what's the cause of the issue in this case, the other problem I've noticed due to this is that wasm-opt prints the whole disassembly to the console upon a validation error. In this case the module is below ~400KB, and it takes ~90 seconds to disassemble and print all of it to the console. I suspect, at least some part of this is due to slow-ish console implementation in VSCode, but it also conceals the original error, making it very hard to find and usually out of scrollback buffer altogether.

Could wasm-opt restrain from printing the whole disassembly, instead opting to only print a binary location in the Wasm module and letting user disassemble separately if they really wish to? (e.g. for the error above it's not strictly necessary or helpful anyway)

## Comments (4)

### kripken (2020-11-16)

Good question, I'm not sure what the right tradeoff is here. Without the printing, the error is pretty unclear. But I guess we could add `run with --show-error` or such.

A small module taking 90 seconds seems like a separate very serious issue, unless that's VSCode specific? Can you provide it?

Btw, for now, can you disable validation, `--no-validation`?

---

### RReverser (2020-11-16)

> Good question, I'm not sure what the right tradeoff is here. Without the printing, the error is pretty unclear.

I guess it depends on the error, but for this one in particular disassembly of the whole module doesn't add as much context as hides the origin even further instead.

I can't really think of error types that both occur in the wild, and where the problem is indeed somewhere in the Wasm code (as in, code or data sections) and not linker-level metadata (imports / exports / memory attributes / etc.). Usually Wasm that comes to wasm-opt either comes directly from LLVM (and, most likely, is already valid on its own) or from other tools (and usually already validated before write).

> Btw, for now, can you disable validation, --no-validation?

Indeed, that's what I did in this case in the end.

FWIW this particular error is somewhat common nowadays due to wasm-pack being stuck on old version of wasm-opt, which doesn't accept mutable globals by default yet, even though Rust can already produce them.

---

### kripken (2020-11-18)

I think I remember that wasm-pack issue. Couldn't we get it to pass `--enable-mutable-globals` to `wasm-opt`, if it enables them in Rust? It should do both in tandem, or neither, it seems.

About the error verbosity here, I don't have a strong opinion either way. If more people agree than disagree then I'm not opposed.

If we do this we'd need to add a flag like `--verbose-errors` or such, as mentioned earlier, but not sure exactly what.

---

### RReverser (2020-11-18)

> Couldn't we get it to pass `--enable-mutable-globals` to `wasm-opt`, if it enables them in Rust?

We could do a lot of things if we could get a new release of `wasm-pack` at all, which is currently not possible :(

---

