# #8117: Clean up FailToEvalExceptions and import stubbing in wasm-ctor.cpp

- **URL:** https://github.com/WebAssembly/binaryen/issues/8117
- **Author:** stevenfontanella
- **Created:** 2025-12-12
- **Updated:** 2025-12-12

## Description

The way that imports are handled in wasm-ctor.cpp is pretty unclear today. All imports must be present, but typically we raise FailToEvalException when trying to read/write them since we don't know what the import contains at the time that wasm-ctor runs. That much is fine, but the code is inconsistent in how it does this. 

* For tags, `getImportedTag` throws [an unreachable exception](https://github.com/WebAssembly/binaryen/blob/56f8f4fa2f7d0c7c2d70e806b4f2c51679118a70/src/tools/wasm-ctor-eval.cpp#L328).
* For memories, the tracking table isn't populated during init, so reads and writes to memories will fail saying that the imported memory doesn't exist: [link](https://github.com/WebAssembly/binaryen/blob/56f8f4fa2f7d0c7c2d70e806b4f2c51679118a70/src/tools/wasm-ctor-eval.cpp#L223).
* Functions are stubbed with [unreachable](https://github.com/WebAssembly/binaryen/blob/56f8f4fa2f7d0c7c2d70e806b4f2c51679118a70/src/tools/wasm-ctor-eval.cpp#L133) (for the 'env' module, and for all modules after #8115).
* And tables and globals will throw FailToEvalException [link](https://github.com/WebAssembly/binaryen/blob/56f8f4fa2f7d0c7c2d70e806b4f2c51679118a70/src/tools/wasm-ctor-eval.cpp#L78-L94).

These all correctly stop evaluation when trying to observe or write to an import, but they all do it in different ways which is confusing. We should clean up the logic here.
