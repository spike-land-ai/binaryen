# #4268: Merge two if-blocks into one if conditions the same

- **URL:** https://github.com/WebAssembly/binaryen/issues/4268
- **Author:** MaxGraey
- **Created:** 2021-10-21
- **Updated:** 2021-10-21

## Description

example:
```ts
export function test(cond: i32): void {
  if (cond) g(1);
  // could be some "side effect"-free (movable) code
  if (cond) g(2);
}
```
actual output:
```wat
(func $test (param $0 i32)
  local.get $0
  if
   i32.const 1
   call $g
  end
  local.get $0
  if
   i32.const 2
   call $g
  end
 )
```
expected output:
```wat
(func $test (param $0 i32)
  local.get $0
  if
   i32.const 1
   call $g
   i32.const 2
   call $g
  end
 )
```

## Comments (2)

### kripken (2021-10-21)

Good idea. Probably makes most sense in RemoveUnusedBrs. Here is where we do the same thing for `br_ifs`, we could do this right before or after it.

https://github.com/WebAssembly/binaryen/blob/24226e6fc3250300e484c8cbe9d1090be5be5dc0/src/passes/RemoveUnusedBrs.cpp#L933

---

### MaxGraey (2021-10-21)

> https://github.com/WebAssembly/binaryen/blob/24226e6fc3250300e484c8cbe9d1090be5be5dc0/src/passes/RemoveUnusedBrs.cpp#L933

Yeah, only that code is in the block (visitBlock). And this can be either in the block or inside function without block. I know very little of code in that pass.  It would be great if you take a look at this when you have some free time.

---

